import requests
from math import floor
from html.parser import HTMLParser
import re
from selenium import webdriver
from selenium.webdriver.common.keys import Keys

# Define a custom HTML parser to extract the math problem from the response
class MathProblemParser(HTMLParser):
    def __init__(self):
        super().__init__();
        self.problem = '';
        self.is_problem = False;
    
    def handle_starttag(self, tag, attrs):
        if tag == 'expression':
            self.is_problem = True;
    
    def handle_data(self, data):
        if self.is_problem:
            self.problem += data.strip();
    
    def handle_endtag(self, tag):
        if tag == 'expression':
            self.is_problem = False;

# Set the URL of the web page that presents the math problem
url = 'http://ctf.hackucf.org:4000/calc/calc.php';

# Send a GET request to the URL to retrieve the problem
driver = webdriver.Firefox();
driver.get(url);
#response = requests.get(url);

# Create an instance of the MathProblemParser and feed it the response text
#parser = MathProblemParser();
#parser.feed(response.text);
#print(parser.problem);

element = driver.find_element('xpath', '/html/body/div/expression')
expression = element.text;
# remove the newlines from the expression
expression = expression.replace('\n', '');
print(expression, end='=');
answer = eval(expression);

'''
operands = re.findall(r'\d+', expression);
operators = re.findall(r'[\+\-\*\/]', expression);
operands = [int(x) for x in operands];

# loop through the operators and operands to calculate the answer
answer = operands[0];
for i in range(len(operators)):
    if operators[i] == '/':
        answer = answer // operands[i+1];
    elif operators[i] == '+':
        answer = answer + operands[i+1];
    elif operators[i] == '-':
        answer = answer - operands[i+1];
    elif operators[i] == '*':
        answer = answer * operands[i+1];
'''
answer = floor(answer);
print(answer);

# Send a POST request to the server with the answer as a parameter
#response = requests.post(url, data={'answer': answer});
#print(response.text);

answerElem = driver.find_element('name', 'answer');
answerElem.send_keys(answer);
answerElem.send_keys(Keys.ENTER);
